<!DOCTYPE html>
<html>
<head>
    <script src="https://telegram.org/js/telegram-web-app.js?59"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <link rel="stylesheet" href="style.css">
    <title>ğŸ“Ÿ Mobila</title>
</head>
<body>
    <div class="container">
        <div class="split-button-group">
            <div class="split-btn">
                <button id="dataOfferAction" class="action-btn">1. Create Data Link</button>
                <button id="dataOfferCopy" class="copy-btn" disabled><span class="emoji">ğŸŒ</span></button>
            </div>
            <div class="split-btn">
                <button id="dataAnswerAction" class="action-btn">Accept Data Link</button>
                <button id="dataAnswerCopy" class="copy-btn" disabled><span class="emoji">ğŸŒ</span></button>
            </div>
        </div>
        <div class="input-group">
            <input id="pasteData" placeholder="Paste peer's offer/answer here..." />
            <button id="useDataBtn">3. Use Data <span class="emoji">ğŸŒ</span></button>
        </div>
        <div class="split-button-group" id="videoControls" style="display:none;">
            <button id="videoOfferAction" class="action-btn">ğŸ“¹ Start Video Call</button>
        </div>
        
        <div id="status" class="status">Ready to create an offer</div>
        
        <video id="localVideo" 
            autoplay 
            muted 
            playsinline 
            webkit-playsinline
            style="width:100%; max-height:200px; object-fit:cover; background:#333;">
        </video>
        <video id="remoteVideo" 
            autoplay 
            playsinline 
            webkit-playsinline
            style="width:100%; max-height:200px; object-fit:cover; background:#333;">
        </video>
        
        <button id="iceDebugBtn" class="debug-btn" onclick="testICE()">test ICE</button>
        <button id="iceServersBtn" class="debug-btn" onclick="testCircuitRelays()">test libp2p</button>
        <button id="debugBtn" class="debug-btn">ğŸ” Debug Log</button>
        <div id="debugLog" class="debug-log"></div>
        <button onclick="resetConnection()" class="debug-btn">ğŸ”„ Reset All</button>
    </div>

    <script src="ui.js"></script>
    <script src="https://unpkg.com/libp2p@latest/dist/index.min.js"></script>
    <script src="https://unpkg.com/@libp2p/webrtc@latest/dist/index.min.js"></script>
    <script src="https://unpkg.com/@libp2p/circuit-relay-v2@latest/dist/index.min.js"></script>
    <script src="business.js"></script>
    <script>
        // Telegram init (UI only)
        Telegram.WebApp.ready();
        Telegram.WebApp.hideKeyboard();
        Telegram.WebApp.enableVerticalSwipes();
        Telegram.WebApp.enableClosingConfirmation();
        // Telegram.WebApp.expand();
        if (navigator.userAgent.includes('TelegramAndroid')) {
            document.addEventListener('DOMContentLoaded', () => {
                // Telegram.WebApp.expand();
                // Force hardware acceleration
                document.body.style.transform = 'translateZ(0)';
            });
        }
        
        // Theme sync
        function updateTheme() {
            ['bg_color', 'text_color', 'button_color', 'button_text_color', 'secondary_bg_color', 'hint_color']
                .forEach(param => {
                    if (Telegram.WebApp.themeParams[param]) {
                        document.documentElement.style.setProperty(
                            `--tg-theme-${param.replace('_', '-')}`, 
                            Telegram.WebApp.themeParams[param]
                        );
                    }
                });
        }
        updateTheme();
        Telegram.WebApp.onEvent('themeChanged', updateTheme);
    </script>
</body>
</html>
